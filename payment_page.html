<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>向商家付款</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* 顶部导航栏 */
        .header {
            background-color: #fff;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e5e5e5;
        }
        
        .header .close {
            font-size: 24px;
            color: #333;
            cursor: pointer;
        }
        
        .header .title-wrap {
            text-align: center;
        }
        
        .header .title {
            font-size: 17px;
            font-weight: 500;
            color: #000;
        }
        
        .header .subtitle {
            font-size: 12px;
            color: #999;
            margin-top: 2px;
        }
        
        .header .more {
            font-size: 20px;
            color: #333;
        }
        
        /* 商家信息 */
        .merchant-info {
            background-color: #fff;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .merchant-left {
            display: flex;
            align-items: center;
        }
        
        .merchant-logo {
            width: 44px;
            height: 44px;
            background-color: #07C160;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }
        
        .merchant-logo svg {
            width: 28px;
            height: 28px;
            fill: #fff;
        }
        
        .merchant-name {
            font-size: 17px;
            font-weight: 500;
            color: #000;
        }
        
        .merchant-address {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
            display: flex;
            align-items: center;
        }
        
        .merchant-address .tag {
            background-color: #07C160;
            color: #fff;
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 2px;
            margin-right: 4px;
        }
        
        .remark-btn {
            font-size: 14px;
            color: #576B95;
        }
        
        /* 金额输入区域 */
        .amount-section {
            background-color: #fff;
            margin-top: 10px;
            padding: 20px 16px;
        }
        
        .amount-label {
            font-size: 14px;
            color: #999;
        }
        
        .amount-input-wrap {
            display: flex;
            align-items: baseline;
            justify-content: flex-end;
            margin-top: 8px;
            border-bottom: 2px solid #07C160;
            padding-bottom: 8px;
        }
        
        .currency {
            font-size: 24px;
            color: #000;
            margin-right: 4px;
        }
        
        .amount-input {
            font-size: 48px;
            font-weight: 300;
            color: #000;
            border: none;
            outline: none;
            text-align: right;
            width: 200px;
            background: transparent;
        }
        
        /* 优惠活动 */
        .promo-section {
            padding: 16px;
        }
        
        .promo-item {
            background-color: #fff;
            border-radius: 8px;
            padding: 16px;
            display: inline-block;
            border: 1px solid #FFD700;
        }
        
        .promo-title {
            font-size: 16px;
            font-weight: 500;
            color: #000;
        }
        
        .promo-desc {
            font-size: 12px;
            color: #FF6600;
            margin-top: 4px;
        }
        
        /* 实付金额 */
        .total-section {
            padding: 0 16px 16px;
            text-align: right;
        }
        
        .total-label {
            font-size: 14px;
            color: #999;
        }
        
        .total-amount {
            font-size: 14px;
            color: #000;
            margin-left: 4px;
        }
        
        .total-amount .yen {
            font-size: 12px;
        }
        
        /* 数字键盘 */
        .keyboard {
            margin-top: auto;
            background-color: #d1d5db;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
        }
        
        .key {
            background-color: #fff;
            height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #000;
            cursor: pointer;
            user-select: none;
        }
        
        .key:active {
            background-color: #e5e5e5;
        }
        
        .key.delete {
            background-color: #fff;
        }
        
        .key.delete svg {
            width: 28px;
            height: 28px;
        }
        
        .key.confirm {
            background-color: #07C160;
            color: #fff;
            font-size: 18px;
            font-weight: 500;
            grid-row: span 2;
        }
        
        .key.confirm:active {
            background-color: #06AD56;
        }
    </style>
</head>
<body>
    <!-- 顶部导航 -->
    <div class="header">
        <span class="close">×</span>
        <div class="title-wrap">
            <div class="title">向商家付款</div>
            <div class="subtitle">qr.shouqianba.com</div>
        </div>
        <span class="more">•••</span>
    </div>
    
    <!-- 商家信息 -->
    <div class="merchant-info">
        <div class="merchant-left">
            <div class="merchant-logo">
                <svg viewBox="0 0 24 24">
                    <path d="M4 4h16v2H4V4zm0 4h16v2H4V8zm0 4h10v2H4v-2zm0 4h10v2H4v-2zm12-4h4v6h-4v-6z"/>
                </svg>
            </div>
            <div>
                <div class="merchant-name">上海丸子火锅演示店</div>
                <div class="merchant-address">
                    <span class="tag">门店</span>
                    上海丸子火锅演示店
                </div>
            </div>
        </div>
        <span class="remark-btn">备注</span>
    </div>
    
    <!-- 金额输入 -->
    <div class="amount-section">
        <div class="amount-label">消费金额</div>
        <div class="amount-input-wrap">
            <span class="currency">¥</span>
            <input type="text" class="amount-input" id="amountInput" value="" placeholder="0" readonly>
        </div>
    </div>
    
    <!-- 优惠活动 -->
    <div class="promo-section">
        <div class="promo-item">
            <div class="promo-title">充1元</div>
            <div class="promo-desc">送1元</div>
        </div>
    </div>
    
    <!-- 实付金额 -->
    <div class="total-section">
        <span class="total-label">实付</span>
        <span class="total-amount"><span class="yen">¥</span><span id="totalAmount">0.00</span></span>
    </div>
    
    <!-- 数字键盘 -->
    <div class="keyboard">
        <div class="key" data-value="1">1</div>
        <div class="key" data-value="2">2</div>
        <div class="key" data-value="3">3</div>
        <div class="key delete" id="deleteKey">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 4H8l-7 8 7 8h13a2 2 0 002-2V6a2 2 0 00-2-2z"/>
                <line x1="18" y1="9" x2="12" y2="15"/>
                <line x1="12" y1="9" x2="18" y2="15"/>
            </svg>
        </div>
        <div class="key" data-value="4">4</div>
        <div class="key" data-value="5">5</div>
        <div class="key" data-value="6">6</div>
        <div class="key confirm" id="confirmBtn">确认<br>支付</div>
        <div class="key" data-value="7">7</div>
        <div class="key" data-value="8">8</div>
        <div class="key" data-value="9">9</div>
        <div class="key" data-value="0">0</div>
        <div class="key" data-value=".">.</div>
        <div class="key"></div>
    </div>
    
    <script>
        var amountInput = document.getElementById('amountInput');
        var totalAmount = document.getElementById('totalAmount');
        var currentAmount = '';
        
        // 更新显示
        function updateDisplay() {
            amountInput.value = currentAmount || '';
            var num = parseFloat(currentAmount) || 0;
            totalAmount.textContent = num.toFixed(2);
        }
        
        // 设置金额（供外部调用）
        function setAmount(amount) {
            currentAmount = amount.toString();
            updateDisplay();
            console.log('WebView: 金额已设置为 ' + amount);
            return 'success';
        }
        
        // 获取当前金额
        function getAmount() {
            return currentAmount || '0';
        }
        
        // 点击确认支付
        function confirmPayment() {
            var amount = parseFloat(currentAmount) || 0;
            if (amount <= 0) {
                alert('请输入金额');
                return 'no_amount';
            }
            console.log('WebView: 确认支付 ' + amount + ' 元');
            // 通知Android调用微信支付
            if (window.AndroidBridge) {
                window.AndroidBridge.onConfirmPayment(amount);
            }
            return 'confirmed';
        }
        
        // 数字键盘点击
        document.querySelectorAll('.key[data-value]').forEach(function(key) {
            key.addEventListener('click', function() {
                var value = this.getAttribute('data-value');
                if (value === '.') {
                    if (currentAmount.indexOf('.') === -1) {
                        currentAmount += currentAmount ? '.' : '0.';
                    }
                } else {
                    // 限制小数点后两位
                    var parts = currentAmount.split('.');
                    if (parts.length === 2 && parts[1].length >= 2) {
                        return;
                    }
                    currentAmount += value;
                }
                updateDisplay();
            });
        });
        
        // 删除键
        document.getElementById('deleteKey').addEventListener('click', function() {
            currentAmount = currentAmount.slice(0, -1);
            updateDisplay();
        });
        
        // 确认支付按钮
        document.getElementById('confirmBtn').addEventListener('click', function() {
            confirmPayment();
        });
    </script>
</body>
</html>
